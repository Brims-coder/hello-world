<script>
// ============================================================================
// –û–°–ù–û–í–ù–û–ô –ö–û–î TRON AI (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô)
// ============================================================================

class TRONAI {
    constructor() {
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        this.config = {
            masterPassword: "@/lovelivelife1992",
            sessionTimeout: 60 * 60 * 1000, // 1 —á–∞—Å
            maxHistory: 100,
            aiName: "TRON",
            version: "2.0",
            user: "root"
        };

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
        this.state = {
            authenticated: false,
            sessionStart: null,
            currentDir: "~",
            commandHistory: [],
            historyIndex: -1,
            aiMode: "gpt",
            memory: [],
            settings: {
                sound: true,
                animations: true,
                autoComplete: true,
                theme: "matrix"
            },
            platform: "desktop"
        };

        // –ö–æ–º–∞–Ω–¥—ã —Å–∏—Å—Ç–µ–º—ã
        this.commands = {
            help: { description: "–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É", execute: () => this.showHelp() },
            clear: { description: "–û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª", execute: () => this.clearTerminal() },
            version: { description: "–í–µ—Ä—Å–∏—è TRON AI", execute: () => this.showVersion() },
            time: { description: "–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è", execute: () => this.showTime() },
            exit: { description: "–í—ã–π—Ç–∏", execute: () => this.logout() },
            ls: { description: "–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤", execute: (args) => this.listDirectory(args) },
            cd: { description: "–°–º–µ–Ω–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é", execute: (args) => this.changeDirectory(args) },
            pwd: { description: "–¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è", execute: () => this.printWorkingDirectory() },
            cat: { description: "–ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª", execute: (args) => this.catFile(args) },
            sysinfo: { description: "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ", execute: () => this.systemInfo() },
            ai: { description: "–ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ò–ò", execute: (args) => this.aiChat(args.join(" ")) },
            mode: { description: "–°–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º –ò–ò", execute: (args) => this.changeMode(args[0]) },
            memory: { description: "–ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞", execute: () => this.showMemory() },
            passwd: { description: "–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å", execute: () => this.changePassword() },
            encrypt: { description: "–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç", execute: (args) => this.encryptText(args.join(" ")) },
            decrypt: { description: "–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç", execute: (args) => this.decryptText(args.join(" ")) },
            calc: { description: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä", execute: (args) => this.calculator(args.join(" ")) },
            echo: { description: "–í—ã–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç", execute: (args) => this.echoText(args.join(" ")) },
            ping: { description: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ", execute: (args) => this.pingHost(args[0]) },
            guess: { description: "–£–≥–∞–¥–∞–π —á–∏—Å–ª–æ", execute: () => this.guessNumberGame() },
            settings: { description: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã", execute: () => this.showSettings() },
            theme: { description: "–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É", execute: (args) => this.changeTheme(args[0]) }
        };

        // –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
        this.fs = {
            "~": {
                type: "dir",
                contents: {
                    "readme.txt": "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ TRON AI!\n\n–≠—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞.\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:\n  ls - —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤\n  cat <file> - –ø–æ–∫–∞–∑–∞—Ç—å —Ñ–∞–π–ª",
                    ".config": {
                        type: "dir",
                        contents: {
                            "ai_settings.json": '{"mode":"gpt","temperature":0.7}',
                            "user_profile.json": '{"name":"root","level":"admin"}'
                        }
                    },
                    "logs": {
                        type: "dir",
                        contents: {
                            "system.log": "2024-01-01: –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞\n2024-01-01: TRON AI –∑–∞–ø—É—â–µ–Ω"
                        }
                    }
                }
            }
        };

        // –°—Å—ã–ª–∫–∏ –Ω–∞ DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        this.elements = {};
        
        this.init();
    }

    // ============================================================================
    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
    // ============================================================================

    init() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        this.elements = {
            authScreen: document.getElementById('auth-screen'),
            terminal: document.getElementById('tron-terminal'),
            authPassword: document.getElementById('auth-password'),
            authLogin: document.getElementById('auth-login'),
            authError: document.getElementById('auth-error'),
            output: document.getElementById('output'),
            commandInput: document.getElementById('command-input'),
            sendBtn: document.getElementById('send-btn'),
            currentDir: document.getElementById('current-dir'),
            suggestions: document.getElementById('suggestions'),
            virtualKeyboard: document.getElementById('virtual-keyboard'),
            showKeyboard: document.getElementById('show-keyboard'),
            commandsPanel: document.getElementById('commands-panel'),
            statusText: document.getElementById('status-text')
        };

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é
        this.checkSession();
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
        this.detectPlatform();
        
        // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        this.bindEvents();
        
        // –†–µ–Ω–¥–µ—Ä–∏–º –∫–æ–º–∞–Ω–¥—ã
        this.renderCommandChips();
        
        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å
        setTimeout(() => {
            if (!this.state.authenticated && this.elements.authPassword) {
                this.elements.authPassword.focus();
            }
        }, 100);
    }

    detectPlatform() {
        const ua = navigator.userAgent.toLowerCase();
        if (/android/.test(ua)) {
            this.state.platform = "android";
            this.config.user = "mobile";
        } else if (/iphone|ipad|ipod/.test(ua)) {
            this.state.platform = "ios";
            this.config.user = "mobile";
        } else if (/windows/.test(ua)) {
            this.state.platform = "windows";
        } else if (/linux/.test(ua)) {
            this.state.platform = "linux";
        } else if (/mac/.test(ua)) {
            this.state.platform = "macos";
        }
    }

    // ============================================================================
    // –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø
    // ============================================================================

    checkSession() {
        try {
            const session = localStorage.getItem('tron_session');
            if (session) {
                const data = JSON.parse(session);
                const now = Date.now();
                
                if (now - data.timestamp < this.config.sessionTimeout) {
                    this.state.authenticated = true;
                    this.state.sessionStart = data.timestamp;
                    
                    setTimeout(() => {
                        this.showTerminal();
                        this.printWelcome();
                    }, 100);
                    
                    return true;
                } else {
                    localStorage.removeItem('tron_session');
                }
            }
        } catch (e) {
            localStorage.removeItem('tron_session');
        }
        return false;
    }

    authenticate(password) {
        // –û—á–∏—â–∞–µ–º –æ—à–∏–±–∫–∏
        this.elements.authError.style.display = 'none';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞—Å–∫—É –ø–∞—Ä–æ–ª—è
        const mask = document.getElementById('password-mask');
        if (mask) mask.style.display = 'block';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        const status = document.getElementById('auth-status');
        if (status) {
            status.innerHTML = '<span class="blink">‚ñ†</span> –ü–†–û–í–ï–†–ö–ê –ü–ê–†–û–õ–Ø...';
        }
        
        // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        setTimeout(() => {
            if (password === this.config.masterPassword) {
                // –£—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
                this.state.authenticated = true;
                this.state.sessionStart = Date.now();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
                localStorage.setItem('tron_session', JSON.stringify({
                    timestamp: this.state.sessionStart,
                    user: this.config.user
                }));
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π —Å—Ç–∞—Ç—É—Å
                if (status) {
                    status.innerHTML = '<span style="color: #00ff00">‚úì</span> –î–û–°–¢–£–ü –†–ê–ó–†–ï–®–ï–ù';
                    status.style.color = '#00ff00';
                }
                
                // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
                setTimeout(() => {
                    if (mask) mask.style.display = 'none';
                    this.showTerminal();
                    this.printWelcome();
                    this.playSound('login');
                }, 500);
                
                return true;
            } else {
                // –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å
                if (mask) mask.style.display = 'none';
                
                // –≠—Ñ—Ñ–µ–∫—Ç –æ—à–∏–±–∫–∏
                this.elements.authPassword.classList.add('access-denied');
                this.elements.authPassword.style.borderColor = 'var(--error)';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                this.elements.authError.textContent = '‚ùå –û–®–ò–ë–ö–ê –î–û–°–¢–£–ü–ê: –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                this.elements.authError.style.display = 'block';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                if (status) {
                    status.innerHTML = '<span style="color: var(--error)">‚úó</span> –î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù';
                    status.style.color = 'var(--error)';
                }
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–Ω–ø—É—Ç
                setTimeout(() => {
                    this.elements.authPassword.classList.remove('access-denied');
                    this.elements.authPassword.style.borderColor = '';
                    this.elements.authPassword.value = '';
                    this.elements.authPassword.focus();
                }, 1500);
                
                this.playSound('error');
                return false;
            }
        }, 800);
    }

    handleLogin() {
        const password = this.elements.authPassword.value.trim();
        
        if (!password) {
            this.elements.authError.textContent = '‚ö†Ô∏è –í–í–ï–î–ò–¢–ï –ü–ê–†–û–õ–Ø';
            this.elements.authError.style.display = 'block';
            return;
        }
        
        this.authenticate(password);
    }

    logout() {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        const status = document.getElementById('auth-status');
        if (status) {
            status.innerHTML = '<span class="blink">‚ñ†</span> –û–ñ–ò–î–ê–ù–ò–ï –í–í–û–î–ê...';
            status.style.color = '';
        }
        
        this.elements.authError.style.display = 'none';
        this.elements.authPassword.value = '';
        this.elements.authPassword.style.borderColor = '';
        
        this.state.authenticated = false;
        localStorage.removeItem('tron_session');
        this.elements.terminal.classList.add('hidden');
        this.elements.authScreen.classList.remove('hidden');
        this.elements.authPassword.focus();
        this.playSound('logout');
    }

    changePassword() {
        this.printMessage('system', '–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è: –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ config.masterPassword –≤ –∫–æ–¥–µ');
    }

    // ============================================================================
    // –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò
    // ============================================================================

    executeCommand(input) {
        if (!input.trim()) return;

        const parts = input.trim().split(' ');
        const command = parts[0].toLowerCase();
        const args = parts.slice(1);

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        this.state.commandHistory.push(input);
        this.state.historyIndex = this.state.commandHistory.length;

        // –í—ã–≤–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        this.printMessage('user', input);

        // –ò—Å–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É
        if (this.commands[command]) {
            try {
                this.commands[command].execute(args);
            } catch (error) {
                this.printMessage('error', `–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${error.message}`);
            }
        } else if (command.startsWith('ai ') || command === 'ai') {
            const question = command === 'ai' ? args.join(' ') : input.substring(3);
            this.aiChat(question);
        } else {
            this.printMessage('error', `–ö–æ–º–∞–Ω–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: ${command}`);
            this.printMessage('system', '–í–≤–µ–¥–∏—Ç–µ "help" –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥');
        }

        this.scrollToBottom();
    }

    aiChat(question) {
        if (!question.trim()) {
            this.printMessage('tron', '–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å: ai –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ò–ò?');
            return;
        }

        this.printMessage('tron', 'ü§î –î—É–º–∞—é...');
        
        setTimeout(() => {
            const response = this.generateAIResponse(question);
            this.printMessage('tron', response);
            
            this.state.memory.push({
                question: question,
                response: response,
                timestamp: Date.now(),
                mode: this.state.aiMode
            });
        }, 500 + Math.random() * 1000);
    }

    generateAIResponse(question) {
        const responses = {
            gpt: [
                `–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é: "${question}"\n\n–†–µ–∫–æ–º–µ–Ω–¥—É—é:\n1. –†–∞–∑–±–∏—Ç—å –∑–∞–¥–∞—á—É\n2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã\n3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è\n4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç`,
                `–í–æ–ø—Ä–æ—Å: ${question}\n\n–û—Ç–≤–µ—Ç:\n‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥\n‚Ä¢ –í–Ω–µ–¥—Ä–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –æ—à–∏–±–æ–∫\n‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
            ],
            llama: [
                `üß† Llama-–º—ã—à–ª–µ–Ω–∏–µ!\n\n"${question}"\n\nüéØ –ö—Ä–µ–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ\nüí° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–π—Ä–æ—Å–µ—Ç–∏\n‚ú® –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã`,
                `–í —Ä–µ–∂–∏–º–µ Llama:\n\n"${question}" - –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ!\nüîÆ –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥\nüåà –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤`
            ],
            deepseek: [
                `üöÄ DeepSeek:\n\n${question}\n\n–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ:\n\`\`\`python\n# –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞\ndef solve():\n    return "—Ä–µ—à–µ–Ω–∏–µ"\n\`\`\``,
                `üîß DeepSeek –æ—Ç–≤–µ—Ç:\n\n1. –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É\n2. –ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–¥\n3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å\n4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å`
            ]
        };

        const modeResponses = responses[this.state.aiMode] || responses.gpt;
        const randomIndex = Math.floor(Math.random() * modeResponses.length);
        
        return `[${this.state.aiMode.toUpperCase()} MODE]\n\n${modeResponses[randomIndex]}`;
    }

    // ============================================================================
    // –ö–û–ú–ê–ù–î–´ –°–ò–°–¢–ï–ú–´
    // ============================================================================

    showHelp() {
        let helpText = "üìö –î–û–°–¢–£–ü–ù–´–ï –ö–û–ú–ê–ù–î–´:\n\n";
        
        const categories = {
            "–û—Å–Ω–æ–≤–Ω—ã–µ": ['help', 'clear', 'version', 'time', 'exit'],
            "–ù–∞–≤–∏–≥–∞—Ü–∏—è": ['ls', 'cd', 'pwd'],
            "–§–∞–π–ª—ã": ['cat'],
            "–°–∏—Å—Ç–µ–º–∞": ['sysinfo'],
            "–ò–ò": ['ai', 'mode', 'memory'],
            "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å": ['passwd', 'encrypt', 'decrypt'],
            "–£—Ç–∏–ª–∏—Ç—ã": ['calc', 'echo', 'ping'],
            "–ò–≥—Ä—ã": ['guess'],
            "–ù–∞—Å—Ç—Ä–æ–π–∫–∏": ['settings', 'theme']
        };
        
        for (const [category, commands] of Object.entries(categories)) {
            helpText += `üîπ ${category}:\n`;
            commands.forEach(cmd => {
                helpText += `  ${cmd.padEnd(10)} - ${this.commands[cmd].description}\n`;
            });
        }
        
        this.printMessage('system', helpText);
    }

    showVersion() {
        const versionText = `
TRON AI v${this.config.version}

‚Ä¢ –õ–æ–∫–∞–ª—å–Ω—ã–π –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç
‚Ä¢ –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å
‚Ä¢ –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å

–°–µ—Å—Å–∏—è:     ${this.state.sessionStart ? new Date(this.state.sessionStart).toLocaleTimeString() : '–ù–æ–≤–∞—è'}
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${this.config.user}
–†–µ–∂–∏–º –ò–ò:    ${this.state.aiMode.toUpperCase()}
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:  ${this.state.platform}
        `;
        this.printMessage('system', versionText);
    }

    showTime() {
        const now = new Date();
        const timeText = `
üìÖ –î–∞—Ç–∞: ${now.toLocaleDateString('ru-RU')}
‚è∞ –í—Ä–µ–º—è: ${now.toLocaleTimeString('ru-RU')}
üåç –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: ${Intl.DateTimeFormat().resolvedOptions().timeZone}
        `;
        this.printMessage('system', timeText);
    }

    systemInfo() {
        const info = `
üíª –°–ò–°–¢–ï–ú–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø:

üåê –ë—Ä–∞—É–∑–µ—Ä: ${navigator.userAgent.split(') ')[0].split('(')[1] || 'Unknown'}
üì± –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${navigator.platform}
üñ•Ô∏è –Ø–∑—ã–∫: ${navigator.language}

üíæ –ü–∞–º—è—Ç—å:
  ‚Ä¢ –ö–æ–º–∞–Ω–¥: ${this.state.commandHistory.length}
  ‚Ä¢ –î–∏–∞–ª–æ–≥–æ–≤ –ò–ò: ${this.state.memory.length}

üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
  ‚Ä¢ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: ${this.state.authenticated ? '‚úÖ' : '‚ùå'}
  ‚Ä¢ –°–µ—Å—Å–∏—è: ${this.state.sessionStart ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞'}
  ‚Ä¢ –†–µ–∂–∏–º: ${this.state.aiMode.toUpperCase()}
        `;
        this.printMessage('system', info);
    }

    listDirectory(args) {
        const path = args[0] || this.state.currentDir;
        let current = this.fs;
        
        if (path === '~' || path === '/') {
            current = this.fs['~'].contents;
        }
        
        let output = `üìÅ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ ${path}:\n\n`;
        const items = [];
        
        for (const [name, item] of Object.entries(current)) {
            if (typeof item === 'object' && item.type === 'dir') {
                items.push(`üìÅ ${name}/`);
            } else if (typeof item === 'string') {
                items.push(`üìÑ ${name}`);
            }
        }
        
        if (items.length === 0) {
            output += "  (–ø—É—Å—Ç–æ)";
        } else {
            items.sort();
            output += items.map(item => `  ${item}`).join('\n');
        }
        
        this.printMessage('system', output);
    }

    changeDirectory(args) {
        if (!args[0]) {
            this.state.currentDir = "~";
            this.updatePrompt();
            this.printMessage('system', '–î–æ–º–∞—à–Ω—è—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è');
            return;
        }
        
        const path = args[0];
        if (path === "..") {
            if (this.state.currentDir !== "~") {
                const parts = this.state.currentDir.split('/');
                parts.pop();
                this.state.currentDir = parts.join('/') || '~';
                this.updatePrompt();
            }
        } else if (path === "~") {
            this.state.currentDir = "~";
            this.updatePrompt();
        } else {
            this.state.currentDir = path;
            this.updatePrompt();
        }
    }

    printWorkingDirectory() {
        this.printMessage('system', `–¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: ${this.state.currentDir}`);
    }

    catFile(args) {
        if (!args[0]) {
            this.printMessage('error', '–£–∫–∞–∂–∏—Ç–µ –∏–º—è —Ñ–∞–π–ª–∞');
            return;
        }
        
        const filename = args[0];
        let current = this.fs['~'].contents;
        
        if (current[filename] && typeof current[filename] === 'string') {
            this.printMessage('system', `üìÑ ${filename}:\n\n${current[filename]}`);
        } else {
            this.printMessage('error', `–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: ${filename}`);
        }
    }

    changeMode(mode) {
        const validModes = ['gpt', 'llama', 'deepseek'];
        
        if (!mode || !validModes.includes(mode.toLowerCase())) {
            this.printMessage('error', `–£–∫–∞–∂–∏—Ç–µ —Ä–µ–∂–∏–º: ${validModes.join(', ')}`);
            return;
        }
        
        this.state.aiMode = mode.toLowerCase();
        this.printMessage('system', `‚úÖ –†–µ–∂–∏–º –ò–ò –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${this.state.aiMode.toUpperCase()}`);
        this.playSound('mode_change');
    }

    showMemory() {
        if (this.state.memory.length === 0) {
            this.printMessage('system', '–ü–∞–º—è—Ç—å –ò–ò –ø—É—Å—Ç–∞');
            return;
        }
        
        let output = "üß† –ü–ê–ú–Ø–¢–¨ –ò–ò:\n\n";
        
        this.state.memory.slice(-5).forEach((item, index) => {
            const time = new Date(item.timestamp).toLocaleTimeString();
            output += `[${time}] [${item.mode.toUpperCase()}]\n`;
            output += `–í–æ–ø—Ä–æ—Å: ${item.question}\n`;
            output += `–û—Ç–≤–µ—Ç: ${item.response.substring(0, 100)}...\n`;
            output += "‚îÄ".repeat(50) + "\n";
        });
        
        output += `\n–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: ${this.state.memory.length}`;
        this.printMessage('system', output);
    }

    encryptText(text) {
        if (!text) {
            this.printMessage('error', '–£–∫–∞–∂–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è');
            return;
        }
        
        const encoded = btoa(unescape(encodeURIComponent(text)));
        this.printMessage('system', `üîê –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n${encoded}`);
        this.playSound('encrypt');
    }

    decryptText(text) {
        if (!text) {
            this.printMessage('error', '–£–∫–∞–∂–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏');
            return;
        }
        
        try {
            const decoded = decodeURIComponent(escape(atob(text)));
            this.printMessage('system', `üîì –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç:\n\n${decoded}`);
            this.playSound('decrypt');
        } catch (e) {
            this.printMessage('error', '–û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏');
        }
    }

    calculator(expression) {
        if (!expression) {
            this.printMessage('error', '–£–∫–∞–∂–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: calc 2 + 2');
            return;
        }
        
        try {
            const safeExpression = expression.replace(/[^0-9+\-*/().\s]/g, '');
            const result = eval(safeExpression);
            this.printMessage('system', `üßÆ –†–µ–∑—É–ª—å—Ç–∞—Ç: ${expression} = ${result}`);
        } catch (e) {
            this.printMessage('error', '–û—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è');
        }
    }

    echoText(text) {
        if (!text) {
            this.printMessage('error', '–£–∫–∞–∂–∏—Ç–µ —Ç–µ–∫—Å—Ç');
            return;
        }
        
        this.printMessage('system', text);
    }

    pingHost(host) {
        if (!host) host = 'localhost';
        const latency = Math.floor(Math.random() * 100) + 1;
        this.printMessage('system', `üèì PING ${host}\n–û—Ç–≤–µ—Ç –∑–∞ ${latency}ms\n–°—Ç–∞—Ç—É—Å: ‚úÖ ONLINE`);
    }

    guessNumberGame() {
        const number = Math.floor(Math.random() * 100) + 1;
        let attempts = 0;
        
        this.printMessage('system', 'üéÆ –ò–ì–†–ê: –£–≥–∞–¥–∞–π —á–∏—Å–ª–æ (1-100)\n–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –∏–ª–∏ "—Å—Ç–æ–ø"');
        
        const gameListener = (input) => {
            const guess = input.trim().toLowerCase();
            
            if (guess === '—Å—Ç–æ–ø' || guess === 'exit') {
                this.printMessage('system', '–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                this.removeGameListener(gameListener);
                return;
            }
            
            const num = parseInt(guess);
            if (isNaN(num) || num < 1 || num > 100) {
                this.printMessage('error', '–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 100');
                return;
            }
            
            attempts++;
            
            if (num === number) {
                this.printMessage('system', `üéâ –£–≥–∞–¥–∞–ª–∏ —á–∏—Å–ª–æ ${number} –∑–∞ ${attempts} –ø–æ–ø—ã—Ç–æ–∫!`);
                this.playSound('win');
                this.removeGameListener(gameListener);
            } else if (num < number) {
                this.printMessage('system', '–ë–æ–ª—å—à–µ!');
            } else {
                this.printMessage('system', '–ú–µ–Ω—å—à–µ!');
            }
        };
        
        this.addGameListener(gameListener);
    }

    showSettings() {
        let settingsText = "‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò:\n\n";
        
        for (const [key, value] of Object.entries(this.state.settings)) {
            settingsText += `  ${key}: ${value ? '‚úÖ' : '‚ùå'}\n`;
        }
        
        this.printMessage('system', settingsText);
    }

    changeTheme(theme) {
        const themes = {
            matrix: ['#00ff00', '#000000'],
            cyberpunk: ['#ff00ff', '#0a0a0a'],
            terminal: ['#ffffff', '#000000']
        };
        
        if (!theme || !themes[theme]) {
            this.printMessage('error', `–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–º—ã: ${Object.keys(themes).join(', ')}`);
            return;
        }
        
        const [primary, bg] = themes[theme];
        document.documentElement.style.setProperty('--primary', primary);
        document.documentElement.style.setProperty('--bg', bg);
        
        this.printMessage('system', `‚úÖ –¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ${theme}`);
        this.playSound('theme_change');
    }

    // ============================================================================
    // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
    // ============================================================================

    printMessage(type, content) {
        if (!this.elements.output) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}-message`;
        
        const timestamp = new Date().toLocaleTimeString('ru-RU', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        
        const headers = {
            user: 'üë§ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨',
            tron: 'ü§ñ TRON AI',
            system: '‚öôÔ∏è –°–ò–°–¢–ï–ú–ê',
            error: '‚ö†Ô∏è –û–®–ò–ë–ö–ê'
        };
        
        messageDiv.innerHTML = `
            <div class="message-header">
                <span>${headers[type] || 'üí¨ –°–û–û–ë–©–ï–ù–ò–ï'}</span>
                <span>${timestamp}</span>
            </div>
            <div class="message-content">${this.formatContent(content)}</div>
        `;
        
        this.elements.output.appendChild(messageDiv);
        this.scrollToBottom();
    }

    formatContent(content) {
        if (!content) return '';
        return content
            .replace(/\n/g, '<br>')
            .replace(/`([^`]+)`/g, '<code>$1</code>')
            .replace(/```([^`]+)```/gs, '<pre>$1</pre>');
    }

    clearTerminal() {
        if (this.elements.output) {
            this.elements.output.innerHTML = '';
        }
        this.printMessage('system', '–¢–µ—Ä–º–∏–Ω–∞–ª –æ—á–∏—â–µ–Ω');
        this.playSound('clear');
    }

    updatePrompt() {
        if (this.elements.currentDir) {
            this.elements.currentDir.textContent = this.state.currentDir;
        }
    }

    scrollToBottom() {
        if (this.elements.output) {
            this.elements.output.scrollTop = this.elements.output.scrollHeight;
        }
    }

    playSound(type) {
        if (!this.state.settings.sound) return;
        
        const sounds = {
            login: [523, 659, 784],
            logout: [784, 659, 523],
            clear: [262, 330, 392],
            mode_change: [392, 494, 587],
            encrypt: [440, 554, 659],
            decrypt: [659, 554, 440],
            win: [659, 830, 988],
            theme_change: [330, 440, 554],
            error: [220, 165, 110]
        };
        
        console.log('–ó–≤—É–∫:', type);
    }

    // ============================================================================
    // UI –£–ü–†–ê–í–õ–ï–ù–ò–ï
    // ============================================================================

    bindEvents() {
        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
        if (this.elements.authLogin) {
            this.elements.authLogin.addEventListener('click', () => this.handleLogin());
        }
        
        if (this.elements.authPassword) {
            this.elements.authPassword.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.handleLogin();
                }
            });
            
            this.elements.authPassword.addEventListener('input', () => {
                if (this.elements.authError) {
                    this.elements.authError.style.display = 'none';
                }
            });
        }
        
        // –ö–æ–º–∞–Ω–¥—ã —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
        if (this.elements.sendBtn) {
            this.elements.sendBtn.addEventListener('click', () => this.handleCommand());
        }
        
        if (this.elements.commandInput) {
            this.elements.commandInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') this.handleCommand();
            });
            
            this.elements.commandInput.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    this.navigateHistory(-1);
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    this.navigateHistory(1);
                }
            });
        }
        
        // –ö–Ω–æ–ø–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const buttons = ['btn-clear', 'btn-help', 'btn-logout', 'btn-settings'];
        buttons.forEach(id => {
            const btn = document.getElementById(id);
            if (btn) {
                btn.addEventListener('click', () => {
                    switch(id) {
                        case 'btn-clear': this.clearTerminal(); break;
                        case 'btn-help': this.showHelp(); break;
                        case 'btn-logout': this.logout(); break;
                        case 'btn-settings': this.showSettings(); break;
                    }
                });
            }
        });
        
        // –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        if (this.elements.showKeyboard) {
            this.elements.showKeyboard.addEventListener('click', () => {
                this.toggleVirtualKeyboard();
            });
        }
        
        // –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∫–Ω–æ–ø–∫–∏
        document.querySelectorAll('.keyboard-key').forEach(key => {
            key.addEventListener('click', () => {
                const keyValue = key.dataset.key;
                const input = this.elements.commandInput;
                
                if (!input) return;
                
                if (keyValue === 'backspace') {
                    input.value = input.value.slice(0, -1);
                } else if (keyValue === 'enter') {
                    this.handleCommand();
                } else if (keyValue === 'space') {
                    input.value += ' ';
                } else {
                    input.value += keyValue;
                }
                
                input.focus();
            });
        });
    }

    handleCommand() {
        if (!this.elements.commandInput) return;
        
        const input = this.elements.commandInput.value.trim();
        if (input) {
            this.executeCommand(input);
            this.elements.commandInput.value = '';
        }
    }

    navigateHistory(direction) {
        if (this.state.commandHistory.length === 0) return;
        
        this.state.historyIndex += direction;
        
        if (this.state.historyIndex < 0) {
            this.state.historyIndex = 0;
        } else if (this.state.historyIndex >= this.state.commandHistory.length) {
            this.state.historyIndex = this.state.commandHistory.length;
            if (this.elements.commandInput) {
                this.elements.commandInput.value = '';
            }
            return;
        }
        
        if (this.elements.commandInput) {
            this.elements.commandInput.value = this.state.commandHistory[this.state.historyIndex];
        }
    }

    renderCommandChips() {
        if (!this.elements.commandsPanel) return;
        
        const commands = ['help', 'sysinfo', 'ai', 'ls', 'clear', 'calc', 'mode'];
        
        this.elements.commandsPanel.innerHTML = commands
            .map(cmd => `<div class="cmd-chip" data-cmd="${cmd}">${cmd}</div>`)
            .join('');
        
        this.elements.commandsPanel.querySelectorAll('.cmd-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                const cmd = chip.dataset.cmd;
                if (cmd === 'ai') {
                    if (this.elements.commandInput) {
                        this.elements.commandInput.value = 'ai ';
                        this.elements.commandInput.focus();
                    }
                } else {
                    this.executeCommand(cmd);
                }
            });
        });
    }

    toggleVirtualKeyboard() {
        if (!this.elements.virtualKeyboard) return;
        
        const keyboard = this.elements.virtualKeyboard;
        if (keyboard.style.display === 'flex') {
            keyboard.style.display = 'none';
        } else {
            keyboard.style.display = 'flex';
            this.scrollToBottom();
        }
    }

    showTerminal() {
        if (this.elements.authScreen) this.elements.authScreen.classList.add('hidden');
        if (this.elements.terminal) this.elements.terminal.classList.remove('hidden');
        if (this.elements.commandInput) this.elements.commandInput.focus();
    }

    printWelcome() {
        const welcome = `
TRON AI v${this.config.version}

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${this.config.user}!
–°–µ—Å—Å–∏—è: ${new Date().toLocaleString('ru-RU')}
–†–µ–∂–∏–º: ${this.state.aiMode.toUpperCase()}

–î–ª—è –Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ "help"
        `;
        
        this.printMessage('system', welcome);
        
        if (this.elements.statusText) {
            this.elements.statusText.textContent = 'AUTHENTICATED';
            this.elements.statusText.style.color = '#00ff00';
        }
    }

    addGameListener(listener) {
        this.gameListener = listener;
    }

    removeGameListener(listener) {
        if (this.gameListener === listener) {
            this.gameListener = null;
        }
    }
}

// ============================================================================
// –ó–ê–ü–£–°–ö –°–ò–°–¢–ï–ú–´
// ============================================================================

document.addEventListener('DOMContentLoaded', () => {
    try {
        window.tronAI = new TRONAI();
        console.log('TRON AI –∑–∞–ø—É—â–µ–Ω');
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ TRON AI:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.');
    }
});

window.addEventListener('beforeunload', () => {
    if (window.tronAI && window.tronAI.state.authenticated) {
        localStorage.setItem('tron_state', JSON.stringify({
            lastCommand: window.tronAI.state.commandHistory.slice(-1)[0],
            timestamp: Date.now()
        }));
    }
});
</script>